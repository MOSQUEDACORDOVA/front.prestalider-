<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Isaac Moqueda • https://www.mosquedacordova.com/">
  <title>PrestaLider</title>
  <!-- Esta CDN es temporal-->
  <link rel="stylesheet" href="https://cdn.hugeicons.com/font/hgi-stroke-rounded.css" />
  <!-- Esta CDN es temporal-->
  <script type="module" src="/src/main.js"></script>
  <base href="/">

  <!-- Custom styles for this template -->
  <style>
    .bi {
      vertical-align: -.125em;
      fill: currentColor;
    }

    .nav-scroller {
      position: relative;
      z-index: 2;
      height: 2.75rem;
      overflow-y: hidden;
    }

    .nav-scroller .nav {
      display: flex;
      flex-wrap: nowrap;
      padding-bottom: 1rem;
      margin-top: -1px;
      overflow-x: auto;
      text-align: center;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
  </style>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->

</head>

<body>
  <my-app></my-app>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="auth.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const ctx = document.getElementById("myChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: ["Enero", "Febrero", "Marzo", "Abril", "Mayo"],
          datasets: [
            {
              label: "Ingresos",
              data: [1200, 1900, 3000, 500, 2200],
              backgroundColor: "rgba(189, 109, 255, 1)",
              borderColor: "rgba(179, 89, 255, 1)",
              borderWidth: 1,
              borderRadius: 100,
            },
            {
              label: "Egresos",
              data: [800, 1200, 1800, 200, 1500],
              backgroundColor: "rgba(200, 200, 200, 1)",
              borderColor: "rgba(200, 200, 200, 1)",
              borderWidth: 1,
              borderRadius: 100,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      
      const btnImprimirRecibo = document.getElementById("btnImprimirRecibo")
      if (btnImprimirRecibo) {
        btnImprimirRecibo.addEventListener("click", () => {
          const contenidoRecibo = document.getElementById("recibo-content").innerHTML
          const ventanaImpresion = window.open("", "_blank")

          ventanaImpresion.document.write(`
                <html>
                <head>
                    <title>Recibo de Pago</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            max-width: 400px;
                            margin: 0 auto;
                            padding: 15px;
                        }
                        .recibo-item {
                            margin-bottom: 8px;
                            font-size: 14px;
                        }
                        .firma-container {
                            margin-top: 20px;
                            margin-bottom: 10px;
                        }
                        .firma-linea {
                            border-top: 1px solid #000;
                            width: 80%;
                            margin: 0 auto;
                        }
                        .firma-texto {
                            font-size: 12px;
                            margin-top: 5px;
                            text-align: center;
                        }
                        .text-center {
                            text-align: center;
                        }
                        .text-info {
                            color: #17a2b8;
                        }
                        .text-danger {
                            color: #dc3545;
                        }
                        .qr-code {
                            max-width: 100px;
                            margin: 0 auto;
                        }
                        h4 {
                            color: #17a2b8;
                        }
                    </style>
                </head>
                <body>
                    ${contenidoRecibo}
                </body>
                </html>
            `)

          ventanaImpresion.document.close()
          ventanaImpresion.focus()

          // Imprimir después de que se cargue el contenido
          setTimeout(() => {
            ventanaImpresion.print()
            // ventanaImpresion.close();
          }, 500)
        })
      }

      // Manejar el botón de WhatsApp
      const btnWhatsAppRecibo = document.getElementById("btnWhatsAppRecibo")
      if (btnWhatsAppRecibo) {
        btnWhatsAppRecibo.addEventListener("click", () => {
          // Crear un mensaje para WhatsApp con los detalles del recibo
          const mensaje = encodeURIComponent(
            "RECIBO DE PAGO\n" +
            "Recibo No.: 247533\n" +
            "Fecha: 24/02/2025 06:38 pm\n" +
            "Recibido de: RAHAM RAFAEL REYES LOPEZ\n" +
            "Monto total: $10.76\n" +
            "Concepto: PAGO CUOTA 4/8\n" +
            "Forma de pago: Efectivo\n" +
            "Capital: $608.02\n" +
            "Interés: $202.74\n" +
            "Capital pendiente: $8,419.36\n" +
            "Próximo pago: 25/03/2025\n\n" +
            "Gracias por tu pago!!",
          )

          // Abrir WhatsApp Web con el mensaje predefinido
          window.open(`https://wa.me/?text=${mensaje}`, "_blank")
        })
      }

      // Obtener parámetros de la URL para la página de detalles
      function getUrlParameter(name) {
        name = name.replace(/[[]/, "\\[").replace(/[\]]/, "\\]")
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)")
        var results = regex.exec(location.search)
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "))
      }

      // Si estamos en la página de detalles, cargar los datos del préstamo
      if (window.location.pathname.includes("detalle-prestamo")) {
        var id = getUrlParameter("id")
        console.log("Cargando detalles del préstamo ID:", id || "default")
      }
      // Manejar el botón de enviar mensaje
      const btnEnviarMensaje = document.getElementById("btnEnviarMensaje")
      if (btnEnviarMensaje) {
        btnEnviarMensaje.addEventListener("click", () => {
          // Obtener los datos del formulario
          const telefono = document.getElementById("telefonoInput").value
          const mensaje = document.getElementById("mensajeTextarea").value

          // Verificar si el checkbox de WhatsApp está marcado
          const whatsappCheck = document.getElementById("whatsappCheck")

          if (whatsappCheck && whatsappCheck.checked) {
            // Enviar mensaje por WhatsApp
            const mensajeEncoded = encodeURIComponent(mensaje)
            window.open(`https://wa.me/${telefono}?text=${mensajeEncoded}`, "_blank")
          }

          // Cerrar el modal
          const enviarMensajeModal = bootstrap.Modal.getInstance(document.getElementById("enviarMensajeModal"))
          enviarMensajeModal.hide()

          // Mostrar notificación de éxito (opcional)
          alert("Mensaje enviado con éxito")
        })
      }
      const mainView = document.getElementById('main-view');
      const detailView = document.getElementById('detail-view');
      const backButton = document.getElementById('back-button');
      const clientName = document.getElementById('client-name');
      const clickableRows = document.querySelectorAll('.clickable-row');
      const emptyState = document.querySelector('.empty-state');

      // Agregar evento de clic a todas las filas clickeables
      clickableRows.forEach(row => {
        row.addEventListener('click', function () {
          // Verificar que los elementos existan antes de manipularlos
          if (mainView && detailView && clientName) {
            // Obtener el nombre del cliente desde el atributo data
            const client = this.getAttribute('data-client');

            // Actualizar el nombre del cliente en la vista detallada
            clientName.textContent = client;

            // Ocultar vista principal y mostrar vista detallada
            mainView.style.display = 'none';
            detailView.style.display = 'block';

            // Desplazarse al inicio de la página
            window.scrollTo(0, 0);
          }
        });
      });

      // Agregar evento de clic al botón de regreso
      if (backButton) {
        backButton.addEventListener('click', function () {
          // Verificar que los elementos existan
          if (mainView && detailView) {
            // Ocultar vista detallada y mostrar vista principal
            detailView.style.display = 'none';
            mainView.style.display = 'block';
          }
        });
      }
      // Manejar cambio de plantilla
      const plantillaSelect = document.getElementById("plantillaSelect")
      if (plantillaSelect) {
        plantillaSelect.addEventListener("change", function () {
          const mensajeTextarea = document.getElementById("mensajeTextarea")
          const plantilla = this.value

          // Cambiar el mensaje según la plantilla seleccionada
          if (plantilla === "CARTA SALDO") {
            mensajeTextarea.value =
              "Distinguid@ Sr/Sra. MARIA DEL CARMEN, Cédula No 031-0252812-6\n\nMediante este documento, certificamos que su préstamo 28987, de fecha $PrestamoFecha, por un monto de DOP$5,000.00 ha sido saldado, por lo que rectificamos que su compromiso por dicho préstamo fue cancelado."
          } else if (plantilla === "RECORDATORIO DE PAGO") {
            mensajeTextarea.value =
              "Estimad@ Sr/Sra. MARIA DEL CARMEN, Cédula No 031-0252812-6\n\nLe recordamos que su próximo pago de préstamo está programado para el 25/03/2025. El monto a pagar es de DOP$810.76.\n\nGracias por su atención."
          } else if (plantilla === "AVISO DE MORA") {
            mensajeTextarea.value =
              "Estimad@ Sr/Sra. MARIA DEL CARMEN, Cédula No 031-0252812-6\n\nLe informamos que su préstamo presenta un atraso en los pagos. Por favor, póngase en contacto con nosotros lo antes posible para regularizar su situación.\n\nGracias por su atención."
          }
        })
      }

      // Obtener parámetros de la URL para la página de detalles
      function getUrlParameter(name) {
        name = name.replace(/[[]/, "\\[").replace(/[\]]/, "\\]")
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)")
        var results = regex.exec(location.search)
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "))
      }

      // Si estamos en la página de detalles, cargar los datos del préstamo
      if (window.location.pathname.includes("detalle-prestamo")) {
        var id = getUrlParameter("id")
        console.log("Cargando detalles del préstamo ID:", id || "default")
      }
      // Get elements
      const solicitarLink = document.getElementById('solicitar-link');
      const consultarLink = document.getElementById('consultar-link');
      const solicitarContent = document.getElementById('solicitar-content');
      const consultarContent = document.getElementById('consultar-content');
      
      // Function to show solicitar content
      function showSolicitar() {
        solicitarLink.classList.add('active');
        consultarLink.classList.remove('active');
        solicitarContent.classList.add('active');
        consultarContent.classList.remove('active');
      }

      // Function to show consultar content
      function showConsultar() {
        consultarLink.classList.add('active');
        solicitarLink.classList.remove('active');
        consultarContent.classList.add('active');
        solicitarContent.classList.remove('active');
      }

      // Add event listeners
      solicitarLink.addEventListener('click', showSolicitar);
      consultarLink.addEventListener('click', showConsultar);

      // Show solicitar content by default
      showSolicitar();
    });

  </script>

</body>